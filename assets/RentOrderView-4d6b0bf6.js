import{R as u,B as y}from"./RentStore-23ee47ae.js";import{r as p,o as h,c as m,d as t,t as i,g as D,w as k,b as B,K as T,I as f,J as g,A as _,B as w,_ as x,L as R,a as b,F as S}from"./index-fd72fc58.js";import"./page-title-bg-196c08fc.js";const v={class:"container lg:my-20"},I={class:"bg-light-purple text-[32px] lg:py-4 lg:px-8"},$={class:"bg-light-white lg:p-8"},A={class:"grid lg:grid-cols-12 lg:gap-6"},C=["src"],W={class:"flex flex-col lg:col-span-4 lg:col-start-9 lg:gap-3"},F={class:"border-b border-dark-gray lg:pb-3"},U=t("span",{class:"block text-sm text-dark-gray"},"取車日期",-1),E={key:0,class:"flex justify-between items-center"},H={class:"bg-transparent text-orange-pink"},L=["value"],P={class:"border-b border-dark-gray lg:pb-3"},z=t("span",{class:"block text-sm text-dark-gray"},"還車日期",-1),M={key:0,class:"flex justify-between items-center"},N={class:"bg-transparent text-orange-pink"},O=["value"],Y={class:"border-b border-dark-gray lg:pb-3"},j=t("span",{class:"block text-sm text-dark-gray"},"車輛資料",-1),J={class:"font-sans-tc mt-1 w-full text-smoke-dark"},K={class:"border-b-4 border-transparent"},q=t("th",{width:"30%",class:"text-left"},"年份",-1),G={class:"border-b-4 border-transparent"},Q=t("th",{width:"30%",class:"text-left"},"品牌",-1),X=t("th",{width:"30%",class:"text-left"},"車款",-1),Z={class:"lg:pb-3"},V=t("span",{class:"block text-sm text-dark-gray"},"會員資料",-1),tt={class:"font-sans-tc mt-1 w-full text-smoke-dark"},et={class:"border-b-4 border-transparent"},rt=t("th",{width:"30%",class:"text-left"},"姓名",-1),st={class:"border-b-4 border-transparent"},at=t("th",{width:"30%",class:"text-left"},"生日",-1),nt=t("th",{width:"30%",class:"text-left"},"電話",-1),ot={class:"grid grid-cols-12 lg:mt-6 lg:border-t-2 lg:border-dashed lg:border-smoke-dark lg:pt-6"},it={class:"flex items-end justify-between lg:col-span-11 lg:col-start-2"},lt={class:"flex flex-col lg:gap-3"},dt={class:"border-b border-dark-gray lg:pb-3"},ct=t("span",{class:"block text-sm text-dark-gray"},"基本金額",-1),ht={class:"font-sans-tc mt-1 bg-transparent text-smoke-dark"},mt={class:"ml-2 bg-transparent text-orange-pink"},ut=T('<p class="border-b border-dark-gray lg:pb-3"><span class="block text-sm text-dark-gray">假日加價</span><span class="font-sans-tc mt-1 bg-transparent text-smoke-dark">TWD <mark class="ml-2 bg-transparent text-orange-pink">+0</mark></span></p><p class="font-sans-tc text-smoke-dark"> * 里程費用<br> 第1至50公里：TWD 6 /公里<br> 第51至150公里：TWD 5 /公里<br> 第151公里以上：TWD 4 /公里 </p>',2),pt={class:"flex items-center lg:gap-3"},_t=t("span",{class:"block text-sm text-dark-gray"}," 租車金額 ",-1),Dt={class:"text-2xl text-orange-pink lg:mr-3"};function kt(e,r,a,o,s,l){const d=p("v-date-picker");return h(),m("section",v,[t("h2",I," 訂單資訊 ("+i(e.orderBike.year)+" "+i(e.orderBike.model)+" - "+i(e.orderBike.grade)+" 級車) ",1),t("div",$,[t("div",A,[t("img",{class:"lg:col-span-6 lg:col-start-2",src:e.orderBike.imgUrl},null,8,C),t("div",W,[t("p",F,[U,s.formattedDate.rent?(h(),m("div",E,[t("mark",H,i(s.formattedDate.rent),1),t("button",{type:"button",class:"btn btn-ghost text-smoke-dark",onClick:r[0]||(r[0]=n=>s.formattedDate.rent=null)},"修改")])):(h(),D(d,{key:1,modelValue:s.tempDate.rent,"onUpdate:modelValue":r[1]||(r[1]=n=>s.tempDate.rent=n),mode:"date",masks:s.masks},{default:k(({inputValue:n,inputEvents:c})=>[t("input",f({class:"input-bordered input input-md w-full max-w-xs text-smoke-dark",value:n},g(c,!0)),null,16,L)]),_:1},8,["modelValue","masks"]))]),t("p",P,[z,s.formattedDate.return?(h(),m("div",M,[t("mark",N,i(s.formattedDate.return),1),t("button",{type:"button",class:"btn btn-ghost text-smoke-dark",onClick:r[2]||(r[2]=n=>s.formattedDate.return=null)},"修改")])):(h(),D(d,{key:1,modelValue:s.tempDate.return,"onUpdate:modelValue":r[3]||(r[3]=n=>s.tempDate.return=n),mode:"date",masks:s.masks},{default:k(({inputValue:n,inputEvents:c})=>[t("input",f({class:"input-bordered input input-md w-full max-w-xs text-smoke-dark",value:n},g(c,!0)),null,16,O)]),_:1},8,["modelValue","masks"]))]),t("div",Y,[j,t("table",J,[t("tr",K,[q,t("td",null,i(e.orderBike.year),1)]),t("tr",G,[Q,t("td",null,i(e.orderBike.make),1)]),t("tr",null,[X,t("td",null,i(e.orderBike.model),1)])])]),t("div",Z,[V,t("table",tt,[t("tr",et,[rt,t("td",null,i(e.user.name),1)]),t("tr",st,[at,t("td",null,i(e.user.birthFormatted),1)]),t("tr",null,[nt,t("td",null,i(e.user.tel),1)])])])])]),t("div",ot,[t("div",it,[t("div",lt,[t("p",dt,[ct,t("span",ht,[B("TWD "),t("mark",mt,i(e.orderBike.rent_price)+" "+i(s.dateSpan?`* ${s.dateSpan}(天數)`:""),1)])]),ut]),t("div",pt,[_t,t("p",Dt," TWD "+i(s.totalRent),1),t("button",{type:"button",class:"btn-primary btn w-40",onClick:r[4]||(r[4]=(...n)=>l.rentConfirm&&l.rentConfirm(...n))}," 確認租車 ")])])])])])}const ft={data(){return{tempDate:{rent:null,return:null},masks:{input:"YYYY/MM/DD"},totalRent:null,data:{},updateData:{},dateSpan:null,formattedDate:{rent:null,return:null}}},computed:{..._(u,["orderBike","rentDate","returnDate","VITE_URL"]),..._(R,["isLoggedIn","user"])},methods:{...w(u,["getBike"]),renderDate(){const e=[new Date(this.rentDate),new Date(this.returnDate)],r=new Intl.DateTimeFormat("zh-TW",{dateStyle:"medium"});this.formattedDate.rent=r.format(e[0]),this.formattedDate.return=r.format(e[1])},renderBirth(){const{date:e}=this.user,r=new Date(e),o=new Intl.DateTimeFormat("zh-TW",{dateStyle:"medium"}).format(r);this.user.birthFormatted=o},rentConfirm(){const e=new Date(this.tempDate.rent).getTime(),r=new Date(this.tempDate.return).getTime();if(!this.isLoggedIn)this.$swal({title:"請登入後繼續",icon:"error",confirmButtonText:"確定"});else if(e>r&&e&&r)this.$swal({title:"取車日期不得晚過還車日期",icon:"error",confirmButtonText:"確定"});else if(!this.formattedDate.rent||!this.formattedDate.return)this.$swal({title:"請確實填寫日期",icon:"error",confirmButtonText:"確定"});else{const a="ordersRent",o="motorcycles",s=`${this.VITE_URL}/${a}`,l=`${this.VITE_URL}/${o}/${this.orderBike.id}`;this.rentDate&&this.returnDate?this.tempDate.rent&&!this.tempDate.return?(this.data={userId:this.user.id,pick_up:new Date(this.tempDate.rent).getTime(),return:this.returnDate,price:this.totalRent,bike_year:this.orderBike.year,bike_model:this.orderBike.model},this.updateData={rent_date:new Date(this.tempDate.rent).getTime(),return_date:this.returnDate},this.callAll(s,l,this.data,this.updateData)):this.tempDate.return&&!this.tempDate.rent?(this.data={userId:this.user.id,pick_up:this.rentDate,return:new Date(this.tempDate.return).getTime(),price:this.totalRent,bike_year:this.orderBike.year,bike_model:this.orderBike.model},this.updateData={rent_date:this.rentDate,return_date:new Date(this.tempDate.return).getTime()},this.callAll(s,l,this.data,this.updateData)):(this.data={userId:this.user.id,pick_up:this.rentDate,return:this.returnDate,price:this.totalRent,bike_year:this.orderBike.year,bike_model:this.orderBike.model},this.updateData={rent_date:this.rentDate,return_date:this.returnDate},this.callAll(s,l,this.data,this.updateData)):this.tempDate.rent&&this.tempDate.return&&(this.data={userId:this.user.id,pick_up:new Date(this.tempDate.rent).getTime(),return:new Date(this.tempDate.return).getTime(),price:this.totalRent,bike_year:this.orderBike.year,bike_model:this.orderBike.model},this.updateData={rent_date:new Date(this.tempDate.rent).getTime(),return_date:new Date(this.tempDate.return).getTime()},this.callAll(s,l,this.data,this.updateData))}},callAll(e,r,a,o){const s=this.$http.post(e,a),l=this.$http.patch(r,o);Promise.all([s,l]).then(d=>{const[{data:n}]=d,c=new Intl.DateTimeFormat("zh-TW",{dateStyle:"medium"});this.$swal({position:"center",title:"租車成功，請按時取車",text:`${c.format(n.pick_up)} ~ ${c.format(n.return)}`,icon:"success",showConfirmButton:!1,timer:2e3}).then(()=>{this.$router.push("/rent")})}).catch(d=>{console.log(d)})},calcDateSpan(e,r){const o=r-e;this.dateSpan=Math.round(o/864e5)},calcRent(){this.dateSpan?this.totalRent=this.dateSpan*this.orderBike.rent_price:this.totalRent=this.orderBike.rent_price}},mounted(){this.getBike(this.$route.params.id),this.rentDate&&this.returnDate&&this.renderDate(),this.user.date&&this.renderBirth(),this.calcDateSpan(this.rentDate,this.returnDate)},watch:{user(e){e.date&&this.renderBirth()},tempDate:{handler(e){const r=new Intl.DateTimeFormat("zh-TW",{dateStyle:"medium"});if(e.rent&&!e.return&&(this.formattedDate.rent=r.format(e.rent)),e.return&&!e.rent&&(this.formattedDate.return=r.format(e.return)),e.rent&&e.return){let a=new Date(e.rent),o=new Date(e.return);a=a.setHours(0,0,0,0),o=o.setHours(23,59,59,999),this.formattedDate.rent=r.format(e.rent),this.formattedDate.return=r.format(e.return),a>o&&this.$swal({title:"取車日期不得晚過還車日期",icon:"error",confirmButtonText:"確定"}).then(()=>{this.dateSpan=null,this.calcRent()}),this.calcDateSpan(a,o),this.calcRent()}if(this.rentDate&&this.returnDate&&e.rent&&!e.return){const a=e.rent.setHours(0,0,0,0);a>this.returnDate&&this.$swal({title:"取車日期不得晚過還車日期",icon:"error",confirmButtonText:"確定"}).then(()=>{this.formattedDate.rent=null,this.dateSpan=null,this.calcRent()}),this.calcDateSpan(a,this.returnDate),this.calcRent()}if(this.rentDate&&this.returnDate&&e.return&&!e.rent){const a=e.return.setHours(23,59,59,999);this.rentDate>a&&this.$swal({title:"取車日期不得晚過還車日期",icon:"error",confirmButtonText:"確定"}).then(()=>{this.formattedDate.return=null,this.dateSpan=null,this.calcRent()}),this.calcDateSpan(this.rentDate,a),this.calcRent()}},deep:!0},orderBike(){this.calcRent()}}},gt=x(ft,[["render",kt]]);function bt(e,r,a,o,s,l){const d=p("banner-component"),n=p("order-component");return h(),m(S,null,[b(d),b(n)],64)}const xt={components:{BannerComponent:y,OrderComponent:gt},computed:{..._(u,["tempBike"])}},wt=x(xt,[["render",bt]]);export{wt as default};
