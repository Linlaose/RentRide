import{R as p,B as y}from"./RentStore-39c57fe8.js";import{r as f,o as c,c as u,d as e,t as d,g as D,w as k,b as w,K as T,I as g,J as b,B as _,C as v,_ as B,L as $,a as x,F as R}from"./index-5c538159.js";import"./page-title-bg-196c08fc.js";const C={class:"container lg:my-20 my-10"},S={class:"bg-light-purple lg:text-[32px] lg:py-4 lg:px-8 text-2xl p-3"},A={class:"bg-light-white lg:p-8"},F={class:"grid lg:grid-cols-12 lg:gap-6"},I=["src"],U={class:"flex flex-col lg:col-span-4 lg:col-start-9 lg:gap-3 px-3 lg:px-0"},E={class:"border-b border-dark-gray lg:pb-3"},W=e("span",{class:"block text-sm text-dark-gray"},"取車日期",-1),H={key:0,class:"flex justify-between items-center"},L={class:"bg-transparent text-orange-pink"},P=["value"],j={class:"border-b border-dark-gray lg:pb-3 mt-2 lg:mt-0"},q=e("span",{class:"block text-sm text-dark-gray"},"還車日期",-1),z={key:0,class:"flex justify-between items-center"},M={class:"bg-transparent text-orange-pink"},N=["value"],O={class:"border-b border-dark-gray lg:pb-3 mt-2 pb-2 lg:mt-0"},Y=e("span",{class:"block text-sm text-dark-gray"},"車輛資料",-1),V={class:"font-sans-tc mt-1 w-full text-smoke-dark"},J={class:"border-b-4 border-transparent"},K=e("th",{width:"30%",class:"text-left"},"年份",-1),G={class:"border-b-4 border-transparent"},Q=e("th",{width:"30%",class:"text-left"},"品牌",-1),X=e("th",{width:"30%",class:"text-left"},"車款",-1),Z={class:"lg:pb-3 mt-2 pb-2 lg:mt-0 border-b border-dark-gray"},tt=e("span",{class:"block text-sm text-dark-gray"},"會員資料",-1),et={class:"font-sans-tc mt-1 w-full text-smoke-dark"},st={class:"border-b-4 border-transparent"},rt=e("th",{width:"30%",class:"text-left"},"姓名",-1),at={class:"border-b-4 border-transparent"},it=e("th",{width:"30%",class:"text-left"},"生日",-1),nt=e("th",{width:"30%",class:"text-left"},"電話",-1),ot={class:"lg:grid p-3 lg:p-0 grid-cols-12 lg:mt-6 lg:border-t-2 lg:border-dashed lg:border-smoke-dark lg:pt-6"},lt={class:"lg:flex items-end justify-between lg:col-span-11 lg:col-start-2"},dt={class:"flex flex-col lg:gap-3 gap-2"},ht={class:"border-b border-dark-gray lg:pb-3 pb-1"},ct=e("span",{class:"block text-sm text-dark-gray"},"基本金額",-1),ut={class:"font-sans-tc mt-1 bg-transparent text-smoke-dark"},mt={class:"ml-2 bg-transparent text-orange-pink"},pt=T('<p class="border-b border-dark-gray lg:pb-3 pb-1"><span class="block text-sm text-dark-gray">假日加價</span><span class="font-sans-tc mt-1 bg-transparent text-smoke-dark">TWD <mark class="ml-2 bg-transparent text-orange-pink">+0</mark></span></p><p class="font-sans-tc text-smoke-dark"> * 里程費用<br> 第1至50公里：TWD 6 /公里<br> 第51至150公里：TWD 5 /公里<br> 第151公里以上：TWD 4 /公里 </p>',2),ft={class:"mt-2 lg:mt-0 flex items-center justify-between lg:justify-start lg:gap-3 flex-wrap lg:flex-nowrap"},_t=e("span",{class:"block text-sm text-dark-gray"}," 租車金額 ",-1),Dt={class:"text-2xl text-orange-pink lg:mr-3"};function kt(t,r,a,i,s,n){const o=f("v-date-picker");return c(),u("section",C,[e("h2",S,d(t.orderBike.year)+" "+d(t.orderBike.model)+" - "+d(t.orderBike.grade)+" 級車 ",1),e("div",A,[e("div",F,[e("img",{class:"lg:col-span-6 lg:col-start-2",src:t.orderBike.imgUrl},null,8,I),e("div",U,[e("p",E,[W,s.formattedDate.rent?(c(),u("div",H,[e("mark",L,d(s.formattedDate.rent),1),e("button",{type:"button",class:"btn btn-ghost text-smoke-dark",onClick:r[0]||(r[0]=l=>s.formattedDate.rent=null)},"修改")])):(c(),D(o,{key:1,modelValue:s.tempDate.rent,"onUpdate:modelValue":r[1]||(r[1]=l=>s.tempDate.rent=l),mode:"date",masks:s.masks,class:"py-2 lg:py-0"},{default:k(({inputValue:l,inputEvents:h})=>[e("input",g({class:"input-bordered input input-md w-full max-w-xs text-smoke-dark",value:l},b(h,!0)),null,16,P)]),_:1},8,["modelValue","masks"]))]),e("p",j,[q,s.formattedDate.return?(c(),u("div",z,[e("mark",M,d(s.formattedDate.return),1),e("button",{type:"button",class:"btn btn-ghost text-smoke-dark",onClick:r[2]||(r[2]=l=>s.formattedDate.return=null)},"修改")])):(c(),D(o,{key:1,modelValue:s.tempDate.return,"onUpdate:modelValue":r[3]||(r[3]=l=>s.tempDate.return=l),mode:"date",masks:s.masks,class:"py-2 lg:py-0"},{default:k(({inputValue:l,inputEvents:h})=>[e("input",g({class:"input-bordered input input-md w-full max-w-xs text-smoke-dark",value:l},b(h,!0)),null,16,N)]),_:1},8,["modelValue","masks"]))]),e("div",O,[Y,e("table",V,[e("tr",J,[K,e("td",null,d(t.orderBike.year),1)]),e("tr",G,[Q,e("td",null,d(t.orderBike.make),1)]),e("tr",null,[X,e("td",null,d(t.orderBike.model),1)])])]),e("div",Z,[tt,e("table",et,[e("tr",st,[rt,e("td",null,d(t.user.name),1)]),e("tr",at,[it,e("td",null,d(t.user.birthFormatted),1)]),e("tr",null,[nt,e("td",null,d(t.user.tel),1)])])])])]),e("div",ot,[e("div",lt,[e("div",dt,[e("p",ht,[ct,e("span",ut,[w("TWD "),e("mark",mt,d(t.orderBike.rent_price)+" "+d(s.dateSpan?`* ${s.dateSpan}(天數)`:""),1)])]),pt]),e("div",ft,[_t,e("p",Dt," TWD "+d(s.totalRent),1),e("button",{type:"button",class:"btn-primary btn lg:w-40 mt-2 lg:mt-0 w-full",onClick:r[4]||(r[4]=(...l)=>n.rentConfirm&&n.rentConfirm(...l))}," 確認租車 ")])])])])])}const gt={data(){return{tempDate:{rent:null,return:null},masks:{input:"YYYY/MM/DD"},totalRent:null,data:{},favoriteData:{},updateData:{},dateSpan:null,formattedDate:{rent:null,return:null},favorites:[]}},computed:{..._(p,["orderBike","rentDate","returnDate","VITE_URL"]),..._($,["isLoggedIn","user"]),catchFavorite(){return this.favorites.filter(t=>t.bike_id===this.orderBike.id)}},methods:{...v(p,["getBike"]),renderDate(){const t=[new Date(this.rentDate),new Date(this.returnDate)],r=new Intl.DateTimeFormat("zh-TW",{dateStyle:"medium"});this.formattedDate.rent=r.format(t[0]),this.formattedDate.return=r.format(t[1])},renderBirth(){const{date:t}=this.user,r=new Date(t),i=new Intl.DateTimeFormat("zh-TW",{dateStyle:"medium"}).format(r);this.user.birthFormatted=i},rentConfirm(){const t=new Date(this.tempDate.rent).getTime(),r=new Date(this.tempDate.return).getTime();if(!this.isLoggedIn)this.$swal({title:"請登入後繼續",icon:"error",confirmButtonText:"確定"});else if(t>r&&t&&r)this.$swal({title:"取車日期不得晚過還車日期",icon:"error",confirmButtonText:"確定"});else if(!this.formattedDate.rent||!this.formattedDate.return)this.$swal({title:"請確實填寫日期",icon:"error",confirmButtonText:"確定"});else{const a="ordersRent",i="motorcycles",s=`${this.VITE_URL}/${a}`,n=`${this.VITE_URL}/${i}/${this.orderBike.id}`;this.rentDate&&this.returnDate?this.tempDate.rent&&!this.tempDate.return?(this.data={userId:this.user.id,pick_up:new Date(this.tempDate.rent).getTime(),return:this.returnDate,price:this.totalRent,bike_year:this.orderBike.year,bike_model:this.orderBike.model},this.updateData={rent_date:new Date(this.tempDate.rent).getTime(),return_date:this.returnDate},this.catchFavorite.length>0?this.callAll(s,n,this.data,this.updateData):this.$swal({title:"要加入收藏嗎 ?",icon:"question",showCancelButton:!0,confirmButtonText:"加入",reverseButtons:!0}).then(o=>{o.isConfirmed?this.$swal({position:"center",icon:"success",title:"收藏成功！",showConfirmButton:!1,timer:1e3}).then(()=>{this.addFavorite(this.user.id),this.callAll(s,n,this.data,this.updateData)}):this.callAll(s,n,this.data,this.updateData)})):this.tempDate.return&&!this.tempDate.rent?(this.data={userId:this.user.id,pick_up:this.rentDate,return:new Date(this.tempDate.return).getTime(),price:this.totalRent,bike_year:this.orderBike.year,bike_model:this.orderBike.model},this.updateData={rent_date:this.rentDate,return_date:new Date(this.tempDate.return).getTime()},this.catchFavorite.length>0?this.callAll(s,n,this.data,this.updateData):this.$swal({title:"要加入收藏嗎 ?",icon:"question",showCancelButton:!0,confirmButtonText:"加入",reverseButtons:!0}).then(o=>{o.isConfirmed?this.$swal({position:"center",icon:"success",title:"收藏成功！",showConfirmButton:!1,timer:1e3}).then(()=>{this.addFavorite(this.user.id),this.callAll(s,n,this.data,this.updateData)}):this.callAll(s,n,this.data,this.updateData)})):(this.data={userId:this.user.id,pick_up:this.rentDate,return:this.returnDate,price:this.totalRent,bike_year:this.orderBike.year,bike_model:this.orderBike.model},this.updateData={rent_date:this.rentDate,return_date:this.returnDate},this.catchFavorite.length>0?this.callAll(s,n,this.data,this.updateData):this.$swal({title:"要加入收藏嗎 ?",icon:"question",showCancelButton:!0,confirmButtonText:"加入",reverseButtons:!0}).then(o=>{o.isConfirmed?this.$swal({position:"center",icon:"success",title:"收藏成功！",showConfirmButton:!1,timer:1e3}).then(()=>{this.addFavorite(this.user.id),this.callAll(s,n,this.data,this.updateData)}):this.callAll(s,n,this.data,this.updateData)})):this.tempDate.rent&&this.tempDate.return&&(this.data={userId:this.user.id,pick_up:new Date(this.tempDate.rent).getTime(),return:new Date(this.tempDate.return).getTime(),price:this.totalRent,bike_year:this.orderBike.year,bike_model:this.orderBike.model},this.updateData={rent_date:new Date(this.tempDate.rent).getTime(),return_date:new Date(this.tempDate.return).getTime()},this.catchFavorite.length>0?this.callAll(s,n,this.data,this.updateData):this.$swal({title:"要加入收藏嗎 ?",icon:"question",showCancelButton:!0,confirmButtonText:"加入",reverseButtons:!0}).then(o=>{o.isConfirmed?this.$swal({position:"center",icon:"success",title:"收藏成功！",showConfirmButton:!1,timer:1e3}).then(()=>{this.addFavorite(this.user.id),this.callAll(s,n,this.data,this.updateData)}):this.callAll(s,n,this.data,this.updateData)}))}},callAll(t,r,a,i){const s=this.$http.post(t,a),n=this.$http.patch(r,i);Promise.all([s,n]).then(o=>{const[{data:l}]=o,h=new Intl.DateTimeFormat("zh-TW",{dateStyle:"medium"});this.$swal({position:"center",title:"租車成功，請按時取車",text:`${h.format(l.pick_up)} ~ ${h.format(l.return)}`,icon:"success",showConfirmButton:!1,timer:2e3}).then(()=>{this.$router.push("/rent")})}).catch(o=>{console.log(o)})},calcDateSpan(t,r){const i=r-t;this.dateSpan=Math.round(i/864e5)},calcRent(){this.dateSpan?this.totalRent=this.dateSpan*this.orderBike.rent_price:this.totalRent=this.orderBike.rent_price},getFavorites(t){const r="favorites",a=`${this.VITE_URL}/users/${t}/${r}`;this.$http.get(a).then(i=>{const{data:s}=i;this.favorites=s}).catch(i=>{console.log(i)})},addFavorite(){const t="favorites",r=`${this.VITE_URL}/${t}`,{make:a,type:i,year:s,model:n,grade:o,id:l,imgUrl:h}=this.orderBike;this.favoriteData={bike_brand:a,bike_type:i,bike_year:s,bike_model:n,bike_grade:o,bike_id:l,imgUrl:h,userId:this.user.id},this.$http.post(r,this.favoriteData).then(m=>{console.log(m)}).catch(m=>{alert(m.response.data)})}},mounted(){this.getBike(this.$route.params.id),this.rentDate&&this.returnDate&&this.renderDate(),this.user.date&&this.renderBirth(),this.calcDateSpan(this.rentDate,this.returnDate),this.getFavorites(this.user.id)},watch:{user(t){t.date&&this.renderBirth()},tempDate:{handler(t){const r=new Intl.DateTimeFormat("zh-TW",{dateStyle:"medium"});if(t.rent&&!t.return&&(this.formattedDate.rent=r.format(t.rent)),t.return&&!t.rent&&(this.formattedDate.return=r.format(t.return)),t.rent&&t.return){let a=new Date(t.rent),i=new Date(t.return);a=a.setHours(0,0,0,0),i=i.setHours(23,59,59,999),this.formattedDate.rent=r.format(t.rent),this.formattedDate.return=r.format(t.return),a>i&&this.$swal({title:"取車日期不得晚過還車日期",icon:"error",confirmButtonText:"確定"}).then(()=>{this.dateSpan=null,this.calcRent()}),this.calcDateSpan(a,i),this.calcRent()}if(this.rentDate&&this.returnDate&&t.rent&&!t.return){const a=t.rent.setHours(0,0,0,0);a>this.returnDate&&this.$swal({title:"取車日期不得晚過還車日期",icon:"error",confirmButtonText:"確定"}).then(()=>{this.formattedDate.rent=null,this.dateSpan=null,this.calcRent()}),this.calcDateSpan(a,this.returnDate),this.calcRent()}if(this.rentDate&&this.returnDate&&t.return&&!t.rent){const a=t.return.setHours(23,59,59,999);this.rentDate>a&&this.$swal({title:"取車日期不得晚過還車日期",icon:"error",confirmButtonText:"確定"}).then(()=>{this.formattedDate.return=null,this.dateSpan=null,this.calcRent()}),this.calcDateSpan(this.rentDate,a),this.calcRent()}},deep:!0},orderBike(){this.calcRent()}}},bt=B(gt,[["render",kt]]);function xt(t,r,a,i,s,n){const o=f("banner-component"),l=f("order-component");return c(),u(R,null,[x(o),x(l)],64)}const Bt={components:{BannerComponent:y,OrderComponent:bt},computed:{..._(p,["tempBike"])}},vt=B(Bt,[["render",xt]]);export{vt as default};
